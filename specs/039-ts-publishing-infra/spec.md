# Feature Specification: TypeScript SDK Publishing Infrastructure

**Feature Branch**: `039-ts-publishing-infra`
**Created**: 2026-01-19
**Status**: Draft
**Input**: User description: "Publish the TypeScript SDK to GitHub Packages with automated
versioning and CI/CD."

## User Scenarios & Testing _(mandatory)_

### User Story 1 - Consumable NPM Package (Priority: P1)

Developers can install the SDK as a versioned dependency from the GitHub Package Registry,
eliminating the need to manually copy or link source code.

**Why this priority**: Core value proposition. Without this, the SDK is not a product but just
source code.

**Independent Test**: Can be fully tested by creating a fresh Node.js project, authenticating with
GitHub Packages, and successfully running `npm install @rshade/finfocus-client`.

**Acceptance Scenarios**:

1. **Given** a developer with a valid `.npmrc` configured for GitHub Packages, **When** they run
   `npm install @rshade/finfocus-client`, **Then** the package is downloaded and added to
   `package.json`.
2. **Given** an installed SDK package, **When** the developer imports it in TypeScript code,
   **Then** type definitions are available and Intellisense works.

---

### User Story 2 - Automated Release Pipeline (Priority: P2)

Maintainers can merge changes to the SDK and have new versions automatically published without
manual intervention.

**Why this priority**: Essential for maintainability. Manual publishing is error-prone and insecure
(requires handling tokens manually).

**Independent Test**: Can be tested by merging a PR with a `fix` commit to the SDK directory and
verifying a GitHub Release and Package are created.

**Acceptance Scenarios**:

1. **Given** a merged Pull Request affecting `sdk/typescript/packages/client`, **When**
   `release-please` creates a release PR and it is merged, **Then** a GitHub Release is created
   with the new version tag.
2. **Given** a new GitHub Release is published, **When** the workflow triggers, **Then** the
   package is built and published to `npm.pkg.github.com`.

---

### User Story 3 - Independent Versioning (Priority: P3)

The TypeScript SDK versioning is decoupled from the main repository (Go SDK) versioning, allowing
the client library to evolve at its own pace.

**Why this priority**: Prevents unnecessary version bumps when only Go code changes, and vice versa.

**Independent Test**: Verify that a change to `sdk/go` does _not_ trigger a version bump for
`@rshade/finfocus-client`.

**Acceptance Scenarios**:

1. **Given** a change limited to the Go SDK, **When** release-please runs, **Then** it does not
   propose a version bump for the TypeScript SDK.
2. **Given** a change limited to the TypeScript SDK, **When** release-please runs, **Then** it
   proposes a version bump for only the TypeScript SDK.

### Edge Cases

- What happens when the build fails during the release workflow? The release is created on GitHub,
  but the package is not published. The workflow should alert maintainers.
- How does the system handle package name conflicts? The package is scoped (`@rshade`), ensuring
  uniqueness on the GitHub Registry.

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: The package MUST be named `@rshade/finfocus-client` to comply with GitHub Package
  Registry scoping rules.
- **FR-002**: The system MUST automatically detect changes in `sdk/typescript/packages/client` and
  propose semantic version bumps.
- **FR-003**: The publishing workflow MUST only trigger when a GitHub Release is officially
  published (not just drafted).
- **FR-004**: The build process MUST generate both ESM and CJS modules along with TypeScript type
  definitions (`.d.ts`).
- **FR-005**: The package MUST include `publishConfig` pointing to `https://npm.pkg.github.com`
  in its manifest.

### Key Entities

- **Package Manifest**: The `package.json` file defining the package identity, version, and dependencies.
- **Release PR**: A pull request generated by `release-please` containing the CHANGELOG update and
  version bump.
- **Artifact**: The tarball (`.tgz`) uploaded to the registry.

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: A developer can successfully execute `npm install @rshade/finfocus-client` in
  < 1 minute (assuming standard network).
- **SC-002**: 100% of merged SDK changes result in a corresponding Release PR (or update to an
  existing one).
- **SC-003**: `npm publish` process runs automatically on release, eliminating manual maintainer
  effort (0 minutes manual time).
- **SC-004**: The package registry shows the correct version number matching the GitHub Release tag.
